//This is for XS4(13)
SetSeed(2101219762,0);
AttachSpec("../Modular/Modular.spec");
Attach("ModCrvToEC.m");
N := 78;
gens := [[0, 7, 61, 0], [1, 0, 26, 1], [1, 1, 64, 27], [1, 26, 0, 1], [3, 2, 29, 37], [27, 26, 52, 53], [52, 27, 51, 13], [52, 57, 57, 13], [55, 3, 15, 76]];
//don't need to check lmfdb j-map because we already know rational points from Banwait-Cremona
//now want to explain the final point
ModEC := InitializeModEC(N,gens);
Iso, Mx := EllipticCurveQuoCandidates(ModEC);
map1 := FindMapsToEC(ModEC, [[ 0, 0, 0, -1521, -22815 ]],[1]: CheckLocal := false);
// [
// -54814691397*x[3]*x[8]^2*x[9] - 33487159644*x[2]*x[7]*x[9]^2 - 8439917250*x[3]*x[7]*x[9]^2 - 8251442103*x[1]*x[8]*x[9]^2 - 151502064234*x[2]*x[8]*x[9]^2 - 8497368528*x[3]*x[8]*x[9]^2 + 307544569968*x[6]*x[8]*x[9]^2 + 177115835448*x[7]*x[8]*x[9]^2 + 231608809458*x[8]^2*x[9]^2 + 121718544573*x[1]*x[9]^3 - 3448082256*x[2]*x[9]^3 - 150859553796*x[3]*x[9]^3 - 245773232826*x[4]*x[9]^3 - 130350208809*x[5]*x[9]^3 - 155996778246*x[6]*x[9]^3 - 102412790529*x[7]*x[9]^3 - 36377776452*x[8]*x[9]^3 - 125804922384*x[9]^4 + 61507256193*x[3]*x[8]^2*x[10] - 103363736439*x[2]*x[7]*x[9]*x[10] + 121568369964*x[3]*x[7]*x[9]*x[10] - 153664768473*x[1]*x[8]*x[9]*x[10] + 132297546003*x[2]*x[8]*x[9]*x[10] + 105420689670*x[3]*x[8]*x[9]*x[10] - 105261442342*x[6]*x[8]*x[9]*x[10] - 81728005829*x[7]*x[8]*x[9]*x[10] - 32618373366*x[8]^2*x[9]*x[10] - 101687317983*x[1]*x[9]^2*x[10] - 143347910925*x[2]*x[9]^2*x[10] - 19742717532*x[3]*x[9]^2*x[10] + 61510092536*x[4]*x[9]^2*x[10] + 210612620931*x[5]*x[9]^2*x[10] - 121552899509*x[6]*x[9]^2*x[10] - 42116512694*x[7]*x[9]^2*x[10] - 32641839787*x[8]*x[9]^2*x[10] - 59643034510*x[9]^3*x[10] + 50916452730*x[2]*x[7]*x[10]^2 - 101099605893*x[3]*x[7]*x[10]^2 + 97193422539*x[1]*x[8]*x[10]^2 - 30414139239*x[2]*x[8]*x[10]^2 - 62326607028*x[3]*x[8]*x[10]^2 - 164407771817*x[6]*x[8]*x[10]^2 - 61387524403*x[7]*x[8]*x[10]^2 - 127152151812*x[8]^2*x[10]^2 + 87561176316*x[1]*x[9]*x[10]^2 + 113171542524*x[2]*x[9]*x[10]^2 - 65642280183*x[3]*x[9]*x[10]^2 + 188910100426*x[4]*x[9]*x[10]^2 + 24223190528*x[5]*x[9]*x[10]^2 + 214998437974*x[6]*x[9]*x[10]^2 + 41743906064*x[7]*x[9]*x[10]^2 + 105572753884*x[8]*x[9]*x[10]^2 + 257502267269*x[9]^2*x[10]^2 - 28699911663*x[1]*x[10]^3 - 12911005017*x[2]*x[10]^3 + 123701605413*x[3]*x[10]^3 - 90040119753*x[4]*x[10]^3 - 72527824310*x[5]*x[10]^3 - 38283486458*x[6]*x[10]^3 + 15896441784*x[7]*x[10]^3 - 83382176640*x[8]*x[10]^3 - 55980720664*x[9]*x[10]^3 - 31712838372*x[10]^4,
// -125438622786*x[3]*x[8]^2*x[9] + 141927287652*x[2]*x[7]*x[9]^2 - 106152304644*x[3]*x[7]*x[9]^2 + 91525082598*x[1]*x[8]*x[9]^2 + 220511927304*x[2]*x[8]*x[9]^2 + 128342791755*x[3]*x[8]*x[9]^2 - 6078447884*x[6]*x[8]*x[9]^2 - 8941910110*x[7]*x[8]*x[9]^2 - 51916610346*x[8]^2*x[9]^2 - 67843496016*x[1]*x[9]^3 - 24895587384*x[2]*x[9]^3 + 133744525956*x[3]*x[9]^3 + 66341072710*x[4]*x[9]^3 + 85671088875*x[5]*x[9]^3 + 21103265738*x[6]*x[9]^3 - 7521479239*x[7]*x[9]^3 + 42110964538*x[8]*x[9]^3 - 35003792042*x[9]^4 - 245647227384*x[3]*x[8]^2*x[10] + 106090694127*x[2]*x[7]*x[9]*x[10] - 67024141488*x[3]*x[7]*x[9]*x[10] + 218108296629*x[1]*x[8]*x[9]*x[10] - 106479611226*x[2]*x[8]*x[9]*x[10] + 98725866867*x[3]*x[8]*x[9]*x[10] - 101405860366*x[6]*x[8]*x[9]*x[10] + 74219607337*x[7]*x[8]*x[9]*x[10] - 94895573826*x[8]^2*x[9]*x[10] - 105067732806*x[1]*x[9]^2*x[10] + 125161005888*x[2]*x[9]^2*x[10] - 53905924512*x[3]*x[9]^2*x[10] + 26381126810*x[4]*x[9]^2*x[10] + 64666007659*x[5]*x[9]^2*x[10] + 402030805541*x[6]*x[9]^2*x[10] + 60273364222*x[7]*x[9]^2*x[10] + 135803383577*x[8]*x[9]^2*x[10] + 38972297320*x[9]^3*x[10] - 1206705348*x[2]*x[7]*x[10]^2 + 296250382989*x[3]*x[7]*x[10]^2 - 89308994364*x[1]*x[8]*x[10]^2 + 188555117418*x[2]*x[8]*x[10]^2 - 48500202618*x[3]*x[8]*x[10]^2 + 132842625279*x[6]*x[8]*x[10]^2 + 85294379691*x[7]*x[8]*x[10]^2 - 87992885352*x[8]^2*x[10]^2 + 59066569962*x[1]*x[9]*x[10]^2 - 42926033313*x[2]*x[9]*x[10]^2 - 103367128095*x[3]*x[9]*x[10]^2 - 148304846916*x[4]*x[9]*x[10]^2 - 252517263592*x[5]*x[9]*x[10]^2 + 143081266076*x[6]*x[9]*x[10]^2 + 21514013148*x[7]*x[9]*x[10]^2 + 19663516308*x[8]*x[9]*x[10]^2 + 70714755961*x[9]^2*x[10]^2 + 240219376461*x[1]*x[10]^3 + 54009810513*x[2]*x[10]^3 - 221275720539*x[3]*x[10]^3 - 235265697147*x[4]*x[10]^3 - 272622079626*x[5]*x[10]^3 - 101571935400*x[6]*x[10]^3 + 147765211590*x[7]*x[10]^3 - 79100309778*x[8]*x[10]^3 - 120642201546*x[9]*x[10]^3 - 92420368734*x[10]^4,
// -4881383977*x[3]*x[8]^2*x[9] + 3028179294*x[2]*x[7]*x[9]^2 - 4740070*x[3]*x[7]*x[9]^2 - 521075833*x[1]*x[8]*x[9]^2 - 1599825736*x[2]*x[8]*x[9]^2 + 225826974*x[3]*x[8]*x[9]^2 - 14467534774*x[6]*x[8]*x[9]^2 - 8992987858*x[7]*x[8]*x[9]^2 - 11737955308*x[8]^2*x[9]^2 + 4824582663*x[1]*x[9]^3 + 1913584362*x[2]*x[9]^3 - 1490598796*x[3]*x[9]^3 + 11736255450*x[4]*x[9]^3 + 6139806787*x[5]*x[9]^3 + 7281333222*x[6]*x[9]^3 + 5245349263*x[7]*x[9]^3 + 2878636804*x[8]*x[9]^3 + 5245968316*x[9]^4 - 2883681330*x[3]*x[8]^2*x[10] + 6943892315*x[2]*x[7]*x[9]*x[10] - 14430859186*x[3]*x[7]*x[9]*x[10] + 18035605804*x[1]*x[8]*x[9]*x[10] + 15293385799*x[2]*x[8]*x[9]*x[10] + 1228850695*x[3]*x[8]*x[9]*x[10] + 5695743722*x[6]*x[8]*x[9]*x[10] + 4912745498*x[7]*x[8]*x[9]*x[10] + 2833866502*x[8]^2*x[9]*x[10] - 26578816168*x[1]*x[9]^2*x[10] + 1273048131*x[2]*x[9]^2*x[10] + 22295054312*x[3]*x[9]^2*x[10] - 3776404676*x[4]*x[9]^2*x[10] - 10413258789*x[5]*x[9]^2*x[10] + 4896967855*x[6]*x[9]^2*x[10] + 847441867*x[7]*x[9]^2*x[10] + 584748500*x[8]*x[9]^2*x[10] + 3099517953*x[9]^3*x[10] - 2518626226*x[2]*x[7]*x[10]^2 + 4176132283*x[3]*x[7]*x[10]^2 - 4057134664*x[1]*x[8]*x[10]^2 + 3050356186*x[2]*x[8]*x[10]^2 + 2748977122*x[3]*x[8]*x[10]^2 + 6523247795*x[6]*x[8]*x[10]^2 + 1814020130*x[7]*x[8]*x[10]^2 + 6005873530*x[8]^2*x[10]^2 + 17073830512*x[1]*x[9]*x[10]^2 - 518419027*x[2]*x[9]*x[10]^2 - 15936805211*x[3]*x[9]*x[10]^2 - 7980377783*x[4]*x[9]*x[10]^2 + 852894566*x[5]*x[9]*x[10]^2 - 10972744935*x[6]*x[9]*x[10]^2 - 2150356438*x[7]*x[9]*x[10]^2 - 6669450476*x[8]*x[9]*x[10]^2 - 12013295280*x[9]^2*x[10]^2 + 2969331215*x[1]*x[10]^3 + 1055365407*x[2]*x[10]^3 - 6680017377*x[3]*x[10]^3 + 5047196728*x[4]*x[10]^3 + 3469628384*x[5]*x[10]^3 + 2859147693*x[6]*x[10]^3 - 1180809655*x[7]*x[10]^3 + 4899376029*x[8]*x[10]^3 + 3200542317*x[9]*x[10]^3 + 1419311037*x[10]^4
// ]
map2 := FindMapsToEC(ModEC, [[ 0, 0, 0, -36, 81 ]], [1] : CheckLocal := false);
//[
// -10378727673*x[3]*x[8]^2 + 6755482488*x[2]*x[7]*x[9] - 23947277466*x[3]*x[7]*x[9] + 15833182143*x[1]*x[8]*x[9] + 26240401722*x[2]*x[8]*x[9] + 16668492117*x[3]*x[8]*x[9] + 10766793648*x[6]*x[8]*x[9] + 7094786019*x[7]*x[8]*x[9] + 6956242806*x[8]^2*x[9] - 23576976333*x[1]*x[9]^2 - 1195328742*x[2]*x[9]^2 + 19218993474*x[3]*x[9]^2 + 2902354290*x[4]*x[9]^2 + 3473989248*x[5]*x[9]^2 + 584812638*x[6]*x[9]^2 - 4498139757*x[7]*x[9]^2 + 793117305*x[8]*x[9]^2 + 382466559*x[9]^3 + 3530908614*x[2]*x[7]*x[10] - 1719464850*x[3]*x[7]*x[10] + 9360636735*x[1]*x[8]*x[10] + 43152413745*x[2]*x[8]*x[10] + 26308920318*x[3]*x[8]*x[10] - 440390964*x[6]*x[8]*x[10] + 2123067936*x[7]*x[8]*x[10] + 8455174290*x[8]^2*x[10] - 21729947136*x[1]*x[9]*x[10] - 1379918649*x[2]*x[9]*x[10] + 22832699064*x[3]*x[9]*x[10] - 4382853897*x[4]*x[9]*x[10] + 341996340*x[5]*x[9]*x[10] + 1902426171*x[6]*x[9]*x[10] + 1770106413*x[7]*x[9]*x[10] - 2112013719*x[8]*x[9]*x[10] + 4005758244*x[9]^2*x[10] + 34347392454*x[1]*x[10]^2 + 10763331846*x[2]*x[10]^2 - 24596769342*x[3]*x[10]^2 + 2437195980*x[4]*x[10]^2 + 4266722316*x[5]*x[10]^2 - 1711784838*x[6]*x[10]^2 - 6171945642*x[7]*x[10]^2 - 1642314276*x[8]*x[10]^2 + 4620214257*x[9]*x[10]^2 + 2566325226*x[10]^3,
// 28730253447*x[3]*x[8]^2 + 18388532124*x[2]*x[7]*x[9] + 33410834091*x[3]*x[7]*x[9] - 2364485832*x[1]*x[8]*x[9] + 26225703423*x[2]*x[8]*x[9] + 6943325148*x[3]*x[8]*x[9] + 13805539286*x[6]*x[8]*x[9] - 6170392151*x[7]*x[8]*x[9] + 12013255092*x[8]^2*x[9] - 10523794473*x[1]*x[9]^2 - 17153777583*x[2]*x[9]^2 + 18918435762*x[3]*x[9]^2 - 13088768728*x[4]*x[9]^2 - 11173064121*x[5]*x[9]^2 - 16581823181*x[6]*x[9]^2 - 1056655796*x[7]*x[9]^2 - 13379979469*x[8]*x[9]^2 + 7566996857*x[9]^3 + 22773758382*x[2]*x[7]*x[10] + 3810487923*x[3]*x[7]*x[10] + 7996612113*x[1]*x[8]*x[10] - 2230739082*x[2]*x[8]*x[10] - 15345374463*x[3]*x[8]*x[10] - 22896832590*x[6]*x[8]*x[10] - 21202179825*x[7]*x[8]*x[10] - 34113397191*x[8]^2*x[10] + 47224068525*x[1]*x[9]*x[10] - 3750547977*x[2]*x[9]*x[10] + 5310529344*x[3]*x[9]*x[10] + 38198842830*x[4]*x[9]*x[10] + 31266585203*x[5]*x[9]*x[10] + 23340095678*x[6]*x[9]*x[10] - 8045298594*x[7]*x[9]*x[10] + 29978153583*x[8]*x[9]*x[10] - 4984911422*x[9]^2*x[10] - 53227184265*x[1]*x[10]^2 - 12932946630*x[2]*x[10]^2 + 76463145018*x[3]*x[10]^2 - 19630462821*x[4]*x[10]^2 - 23402458044*x[5]*x[10]^2 - 6381115008*x[6]*x[10]^2 - 4986681936*x[7]*x[10]^2 - 2336553186*x[8]*x[10]^2 + 6209529210*x[9]*x[10]^2 - 7156880751*x[10]^3,
// 1907303530*x[3]*x[8]^2 + 3277467776*x[2]*x[7]*x[9] - 4606709871*x[3]*x[7]*x[9] + 4799801349*x[1]*x[8]*x[9] + 18460695245*x[2]*x[8]*x[9] + 7200663983*x[3]*x[8]*x[9] + 4424948358*x[6]*x[8]*x[9] + 2960163297*x[7]*x[8]*x[9] + 2732448960*x[8]^2*x[9] - 14238921894*x[1]*x[9]^2 - 2803437551*x[2]*x[9]^2 + 12487176154*x[3]*x[9]^2 + 246361480*x[4]*x[9]^2 + 266262991*x[5]*x[9]^2 + 105829531*x[6]*x[9]^2 - 1696200436*x[7]*x[9]^2 - 405180189*x[8]*x[9]^2 + 623904605*x[9]^3 - 1476163784*x[2]*x[7]*x[10] + 7204532265*x[3]*x[7]*x[10] - 8220045034*x[1]*x[8]*x[10] - 2236060013*x[2]*x[8]*x[10] + 4487484331*x[3]*x[8]*x[10] + 3187165554*x[6]*x[8]*x[10] + 2760014971*x[7]*x[8]*x[10] + 2911481129*x[8]^2*x[10] + 16925960275*x[1]*x[9]*x[10] + 4852548324*x[2]*x[9]*x[10] - 14077216028*x[3]*x[9]*x[10] - 1879096874*x[4]*x[9]*x[10] - 603999977*x[5]*x[9]*x[10] + 3675652274*x[6]*x[9]*x[10] + 484054246*x[7]*x[9]*x[10] - 96708377*x[8]*x[9]*x[10] + 1747793258*x[9]^2*x[10] - 6723696801*x[1]*x[10]^2 - 792241712*x[2]*x[10]^2 + 4696571070*x[3]*x[10]^2 - 2902494753*x[4]*x[10]^2 - 776387860*x[5]*x[10]^2 + 912553732*x[6]*x[10]^2 + 880799572*x[7]*x[10]^2 - 1402254874*x[8]*x[10]^2 + 1112179802*x[9]*x[10]^2 + 233243689*x[10]^3
// ]
//
X := Domain(map1[1]);
pts := PointSearch(X,100);
// [ (1 : 1 : 0 : 0 : 1 : 0 : 2 : -1 : 0 : 1), (-1 : -1 : 0 : 0 : 1 : 0 : 2 : -1 : 0 : 1), (0 : 1 : 0 : 1/2 : -1 : -1/2 : -1/2 : 0 : 1 : 1), (0 : -1 : 0 : 1/2 : -1 : -1/2 : -1/2 : 0 : 1 : 1) ]
psi1 := map1[1];
psi2 := map2[1];
assert psi1(pts[1]) eq psi1(pts[3]);
assert psi1(pts[2]) eq psi1(pts[4]);
// psi(pts[1]);
// (0 : 1 : 0)
// > psi(pts[2]);
// (1135 : -38215 : 1)
// > psi(pts[3]);
// (0 : 1 : 0)
// > psi(pts[4]);
// (1135 : -38215 : 1)
P9<[x]> :=  Ambient(X);
i := map<X -> X | [-x[1], -x[2], -x[3], x[4], x[5], x[6], x[7], x[8],x[9],x[10]]>;
assert i(pts[1]) eq pts[2];
assert i(pts[3]) eq pts[4];
b, a  := IsAutomorphism(i);
A := AutomorphismGroup(X, [a]);
C, pi := CurveQuotient(A);
Cplane := PlaneCurve(C);
P2<x,y,z> := Ambient(Cplane);
f := 5*x^4 - 7*x^3*y + 8*x^3*z + 3*x^2*y^2 - 7*x^2*y*z + 4*x^2*z^2 + 2*x*y^3 - 2*x*y^2*z - 5*x*y*z^2 - 3*x*z^3 + 5*y^3*z + y^2*z^2 + 2*y*z^3;
Clmfdb := Curve(P2, f);
b, iso := IsIsomorphicPlaneQuartics(Cplane,Clmfdb);
assert b; 
assert pi(pts[1]) eq pi(pts[2]);
assert pi(pts[3]) eq pi(pts[4]);
im_1 := Vector(Eltseq(pi(pts[1])))*Transpose(iso[1]);
Clmfdb!Eltseq(im_1); //this is a CM point with j = 0

//now check fibers of the map
im_3psi1 := psi1(pts[3]);
im_3psi2 := psi2(pts[3]);
fib_psi1 := im_3psi1@@psi1;
fib_psi2 := im_3psi2@@psi2;
fib_int := fib_psi1 meet fib_psi2;
assert Degree(fib_int) eq 1; //only one point
assert RationalPoints(fib_int)[1] eq pts[3]; //the point is pts[3]

im_4psi1 := psi1(pts[4]);
im_4psi2 := psi2(pts[4]);
fib_psi1 := im_4psi1@@psi1;
fib_psi2 := im_4psi2@@psi2;
fib_int := fib_psi1 meet fib_psi2;
assert Degree(fib_int) eq 1; //only one point
assert RationalPoints(fib_int)[1] eq pts[4]; //the point is pts[4]


//Uniqueness of the involution
X7 := ChangeRing(X, GF(7));
A7 := AutomorphismGroup(Xp);
X5 := ChangeRing(X, GF(5));
A5 := AutomorphismGroup(X5);
assert #A7 eq 2;
assert #A5 eq 2;

